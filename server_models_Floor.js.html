<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server/models/Floor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server/models/Floor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module  models/Floor */

import mongoose from 'mongoose';
import db from './db';

const { Schema } = mongoose;

/**
 * represents JSONified SVG data
 * @typedef  {Object}  Layer
 * @prop  {Object}  _declaration
 * @prop  {Object}  _declaration._attributes
 * @prop  {String}  _declaration._attributes.version
 * @prop  {Object}  svg
 * @prop  {Object}  svg._attributes
 * @prop  {String}  svg._attributes.xmlns
 * @prop  {String}  svg._attributes.xmlns:xlink
 * @prop  {String}  svg._attributes.version
 * @prop  {String}  svg._attributes.preserveAspectRatio
 * @prop  {String}  svg._attributes.viewBox
 * @prop  {String}  svg._attributes.width
 * @prop  {String}  svg._attributes.height
 * @prop  {Array.&lt;Object>}  svg.path
 * @prop  {Object}  svg.path._attributes
 * @prop  {String}  svg.path.fill
 * @prop  {String}  svg.path.stroke
 * @prop  {String}  svg.path.stroke-width
 * @prop  {String}  svg.path.d
 */

/**
 * Database schema for SVG layers
 * @const  LayerSchema
 * @memberof  module:models/Floor
 */

const LayerSchema = new Schema({
  _declaration: {
    _attributes: {
      version: String,
    },
  },
  svg: {
    _attributes: {
      xmlns: String,
      'xmlns:xlink': String,
      version: String,
      preserveAspectRatio: String,
      viewBox: String,
      width: String,
      height: String,
    },
    path: [
      {
        _attributes: {
          fill: String,
          stroke: String,
          'stroke-width': String,
          d: String,
        },
      },
    ],
  },
});

/**
 * Represents a single floor within a building
 * @const
 * @typedef  {Object}  Floor
 * @prop  {ObjectId}  building  reference to the associated building
 * @prop  {String}  floorNumber  which floor this is
 * @prop  {Array.&lt;Facility>} facilities  Virtual links to Facilities
 * @prop  {Array.&lt;Layer>} layers  A collection of JSON objects
 *        representing SVG data for each floor
 */

/**
 * Database schema for a single Floor inside a building layers
 * @const  FloorSchema
 * @memberof  module:models/Floor
 */

const FloorSchema = new Schema(
  {
    building: {
      type: Schema.Types.ObjectId,
      ref: 'Building',
      required: true,
    },
    floorNumber: { type: String, required: true },
    layers: [{ type: LayerSchema }],
  },
  {
    timestamps: true,
    toJSON: {
      getters: true,
      virtual: true,
    },
  }
);

FloorSchema.index({ building: 1, floorNumber: -1 });

FloorSchema.virtual('facilities', {
  ref: 'Facility',
  localField: 'floorplan',
  foreignField: '_id',
});

/**
 * Returns all floor objects in the datbase
 * @async
 * @static getAll
 * @memberof module:models/floor
 * @returns {Promise.&lt;FloorData[]>}  All of the floor data for a building
 */

FloorSchema.statics.getAll = async function getAll() {
  try {
    return this.find({}).exec();
  } catch (err) {
    throw new Error(`Could not retrieve all floor objects.\n${err.message}`);
  }
};

/**
 * Returns one complete floor object
 * @async
 * @static getOneById
 * @memberof module:models/floor
 * @param {String} floorId  The mongo id of the floor
 * @returns {Promise.&lt;FloorData>}  the compmlete floor object
 */

FloorSchema.statics.getOneById = async function getOneById(floorId) {
  try {
    return this.findById(floorId).exec();
  } catch (err) {
    throw new Error(
      `Could not retrieve floor object ${floorId}.\n${err.message}`
    );
  }
};

/**
 * Creates a new floor object
 * @async
 * @static createNew
 * @memberof module:models/floor
 * @param {FloorData} floorData the new floor to create
 * @returns {FloorData}  The mongofied floor data object
 */

FloorSchema.statics.createNew = async function createNew(floorData) {
  try {
    const newFloor = new this(floorData);
    return newFloor.save();
  } catch (err) {
    throw new Error(`Could not create new Floor.${err.message}`);
  }
};

const Floor = db.model('Floor', FloorSchema);

export default Floor;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-models_Building.html">models/Building</a></li><li><a href="module-models_Facility.html">models/Facility</a></li><li><a href="module-models_Floor.html">models/Floor</a></li><li><a href="module-server_errorHandler.html">server/errorHandler</a></li><li><a href="module-test_populateDB.html">test/populateDB</a></li><li><a href="module-TestData_Building.html">TestData/Building</a></li><li><a href="module-TestData_Floorplan.html">TestData/Floorplan</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Nov 10 2018 21:23:30 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
